<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„Ø¹Ø¨Ø© XO Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† + Ø¯Ø±Ø¯Ø´Ø©</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ===== CSS Variables ===== */
        :root {
            --primary: #3b5cff;
            --secondary: #6a11cb;
            --accent: #ff6b6b;
            --success: #4CAF50;
            --warning: #FF9800;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --shadow: 0 5px 15px rgba(0,0,0,0.1);
            --gradient: linear-gradient(135deg, #6a11cb, #2575fc);
            --border-radius: 15px;
        }

        /* ===== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ø§Ù…Ø© ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Cairo', sans-serif;
        }

        body {
            background: var(--gradient);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            transition: background-image 0.5s ease;
            position: relative;
        }

        body.custom-bg::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: -1;
        }

        /* ===== Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ===== */
        .game-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            max-width: 1200px;
            width: 100%;
            background: rgba(255, 255, 255, 0.95);
            border-radius: var(--border-radius);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
            padding: 25px;
            position: relative;
        }

        @media (max-width: 992px) {
            .game-container {
                grid-template-columns: 1fr;
                max-width: 600px;
            }
        }

        /* ===== Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ÙˆØ§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† ===== */
        .control-panel {
            padding: 15px;
        }

        .user-info {
            background: var(--light);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
        }

        .user-info h3 {
            color: var(--primary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            font-weight: bold;
            margin: 0 auto 15px;
        }

        .user-details {
            text-align: center;
        }

        .user-name {
            font-weight: bold;
            font-size: 1.2rem;
            color: var(--dark);
            margin-bottom: 5px;
        }

        .user-status {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .status-online {
            background: rgba(76, 175, 80, 0.2);
            color: var(--success);
        }

        .status-offline {
            background: rgba(108, 117, 125, 0.2);
            color: var(--gray);
        }

        .status-waiting {
            background: rgba(255, 152, 0, 0.2);
            color: var(--warning);
        }

        .status-playing {
            background: rgba(59, 92, 255, 0.2);
            color: var(--primary);
        }

        /* ===== Ù„ÙˆØ­Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© ===== */
        .game-board {
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .game-header {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: var(--light);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }

        .current-turn {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .turn-indicator {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .turn-x {
            background: #ff4444;
            color: white;
        }

        .turn-o {
            background: #3b5cff;
            color: white;
        }

        .game-stats {
            text-align: center;
        }

        .game-timer {
            font-size: 0.9rem;
            color: var(--gray);
        }

        .xo-board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            background: white;
            padding: 15px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 20px;
        }

        .cell {
            width: 100px;
            height: 100px;
            font-size: 3rem;
            font-weight: bold;
            border: 3px solid #e9ecef;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        @media (max-width: 768px) {
            .cell {
                width: 80px;
                height: 80px;
                font-size: 2.5rem;
            }
        }

        .cell:hover:not(.disabled) {
            background: #f8f9fa;
            transform: scale(1.05);
            border-color: var(--primary);
        }

        .cell.disabled {
            cursor: not-allowed;
            opacity: 0.8;
        }

        .cell.x {
            color: #ff4444;
            text-shadow: 0 0 10px rgba(255, 68, 68, 0.3);
        }

        .cell.o {
            color: #3b5cff;
            text-shadow: 0 0 10px rgba(59, 92, 255, 0.3);
        }

        .game-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: #2a4ae0;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(59, 92, 255, 0.3);
        }

        .btn-secondary {
            background: var(--secondary);
            color: white;
        }

        .btn-secondary:hover {
            background: #5909b8;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(106, 17, 203, 0.3);
        }

        .btn-accent {
            background: var(--accent);
            color: white;
        }

        .btn-accent:hover {
            background: #ff5252;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #3d8b40;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
        }

        .btn-light {
            background: var(--light);
            color: var(--dark);
        }

        .btn-light:hover {
            background: #e9ecef;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        /* ===== Ù„ÙˆØ­Ø© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© ===== */
        .chat-panel {
            display: flex;
            flex-direction: column;
            height: 600px;
            background: var(--light);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .chat-header {
            background: var(--primary);
            color: white;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-title {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .online-count {
            background: rgba(255, 255, 255, 0.2);
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
        }

        .chat-messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column-reverse;
        }

        .chat-messages::-webkit-scrollbar {
            width: 8px;
        }

        .chat-messages::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 10px;
        }

        .message {
            margin-bottom: 15px;
            padding: 10px 15px;
            border-radius: 15px;
            max-width: 80%;
            animation: fadeIn 0.3s ease;
            position: relative;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.sent {
            align-self: flex-end;
            background: var(--primary);
            color: white;
            border-bottom-right-radius: 5px;
        }

        .message.received {
            align-self: flex-start;
            background: white;
            color: var(--dark);
            border: 1px solid #e9ecef;
            border-bottom-left-radius: 5px;
        }

        .message.system {
            align-self: center;
            background: #f8f9fa;
            color: var(--gray);
            font-style: italic;
            text-align: center;
            max-width: 90%;
            border: 1px dashed #dee2e6;
        }

        .message-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.8rem;
            opacity: 0.9;
        }

        .message-sender {
            font-weight: bold;
        }

        .message-time {
            font-size: 0.7rem;
        }

        .message-content {
            word-wrap: break-word;
        }

        .chat-input {
            padding: 15px;
            border-top: 1px solid #e9ecef;
            display: flex;
            gap: 10px;
        }

        .chat-input input {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 25px;
            font-size: 0.9rem;
            transition: all 0.3s;
        }

        .chat-input input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(59, 92, 255, 0.2);
        }

        /* ===== Ù„ÙˆØ­Ø© Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ† ===== */
        .leaderboard-panel {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            margin-top: 20px;
            box-shadow: var(--shadow);
        }

        .leaderboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .leaderboard-title {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--primary);
        }

        .leaderboard-list {
            max-height: 200px;
            overflow-y: auto;
        }

        .leaderboard-item {
            display: flex;
            align-items: center;
            padding: 10px;
            margin-bottom: 8px;
            background: var(--light);
            border-radius: 10px;
            transition: all 0.3s;
        }

        .leaderboard-item:hover {
            transform: translateX(5px);
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .leaderboard-item.current-user {
            background: rgba(59, 92, 255, 0.1);
            border-left: 4px solid var(--primary);
        }

        .leaderboard-rank {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-left: 10px;
        }

        .rank-1 { background: gold; color: #333; }
        .rank-2 { background: silver; color: #333; }
        .rank-3 { background: #cd7f32; color: white; }
        .rank-other { background: #e9ecef; color: var(--gray); }

        .leaderboard-name {
            flex: 1;
            font-weight: bold;
        }

        .leaderboard-score {
            font-weight: bold;
            color: var(--primary);
            font-size: 1.1rem;
        }

        /* ===== Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ ÙˆØ§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© ===== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: white;
            border-radius: var(--border-radius);
            padding: 30px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            transform: translateY(-20px);
            transition: transform 0.3s;
        }

        .modal-overlay.active .modal {
            transform: translateY(0);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            color: var(--primary);
            font-size: 1.5rem;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: var(--dark);
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(59, 92, 255, 0.2);
        }

        .color-preview {
            width: 30px;
            height: 30px;
            border-radius: 5px;
            border: 2px solid #e9ecef;
            margin-top: 10px;
        }

        .language-switch {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .lang-btn {
            flex: 1;
            padding: 8px;
            border: 2px solid #e9ecef;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .lang-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* ===== Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ===== */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            padding: 15px 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 15px;
            z-index: 1001;
            transform: translateX(150%);
            transition: transform 0.5s;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: white;
        }

        .notification-success .notification-icon { background: var(--success); }
        .notification-info .notification-icon { background: var(--primary); }
        .notification-warning .notification-icon { background: var(--warning); }
        .notification-error .notification-icon { background: var(--accent); }

        /* ===== Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø®Ù„ÙÙŠØ© ===== */
        .bg-options {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #e9ecef;
        }

        .bg-preview {
            width: 100%;
            height: 100px;
            border-radius: 10px;
            background-size: cover;
            background-position: center;
            margin-bottom: 10px;
            border: 2px solid #e9ecef;
        }

        .bg-actions {
            display: flex;
            gap: 10px;
        }

        /* ===== Ø±Ù…ÙˆØ² Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† ===== */
        .symbol-options {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }

        .symbol-option {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
            cursor: pointer;
            border: 3px solid #e9ecef;
            transition: all 0.3s;
        }

        .symbol-option.active {
            border-color: var(--primary);
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .symbol-x { color: #ff4444; }
        .symbol-o { color: #3b5cff; }
        .symbol-heart { color: #ff6b6b; }
        .symbol-star { color: #FF9800; }

        /* ===== ØªØ°ÙŠÙŠÙ„ Ø§Ù„ØµÙØ­Ø© ===== */
        .footer {
            text-align: center;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #e9ecef;
            color: var(--gray);
            font-size: 0.8rem;
        }

        .players-online {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .player-badge {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 5px 10px;
            background: white;
            border-radius: 20px;
            font-size: 0.8rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .player-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .indicator-online { background: var(--success); }
        .indicator-playing { background: var(--primary); }
        .indicator-waiting { background: var(--warning); }
    </style>
</head>
<body>
    <!-- Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
    <div class="game-container">
        <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… -->
        <div class="control-panel">
            <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… -->
            <div class="user-info">
                <h3><i class="fas fa-user"></i> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨</h3>
                <div class="user-avatar" id="userAvatar">?</div>
                <div class="user-details">
                    <div class="user-name" id="userName">Ø¬Ø§Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
                    <div class="user-status">
                        <span id="userStatus" class="status-offline">ØºÙŠØ± Ù…ØªØµÙ„</span>
                    </div>
                    <div class="game-stats" id="userStats">
                        <div>Ø§Ù„Ù†Ù‚Ø§Ø·: <span id="userScore">0</span></div>
                        <div>Ø§Ù„ÙÙˆØ²: <span id="userWins">0</span></div>
                    </div>
                </div>
                <div class="game-actions" style="margin-top: 15px;">
                    <button class="btn btn-primary" id="changeSettings">
                        <i class="fas fa-cog"></i> Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                    </button>
                    <button class="btn btn-secondary" id="findOpponent">
                        <i class="fas fa-search"></i> Ø§Ø¨Ø­Ø« Ø¹Ù† Ø®ØµÙ…
                    </button>
                </div>
            </div>

            <!-- Ø§Ù„Ù„Ø§Ø¹Ø¨ÙˆÙ† Ø§Ù„Ù…ØªØµÙ„ÙˆÙ† -->
            <div class="user-info">
                <h3><i class="fas fa-users"></i> Ø§Ù„Ù„Ø§Ø¹Ø¨ÙˆÙ† Ø§Ù„Ù…ØªØµÙ„ÙˆÙ†</h3>
                <div class="players-online" id="playersOnline">
                    <div class="player-badge">
                        <div class="player-indicator indicator-online"></div>
                        <span>Ø¬Ø§Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>
                    </div>
                </div>
            </div>

            <!-- Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ† -->
            <div class="leaderboard-panel">
                <div class="leaderboard-header">
                    <div class="leaderboard-title">
                        <i class="fas fa-trophy"></i> Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ†
                    </div>
                    <button class="btn btn-light" id="refreshLeaderboard">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                </div>
                <div class="leaderboard-list" id="leaderboardList">
                    <div class="leaderboard-item">
                        <div class="leaderboard-rank rank-1">1</div>
                        <div class="leaderboard-name">Ø¬Ø§Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
                        <div class="leaderboard-score">0</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ù„ÙˆØ­Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© ÙˆØ§Ù„Ø¯Ø±Ø¯Ø´Ø© -->
        <div class="game-board">
            <!-- Ø±Ø£Ø³ Ø§Ù„Ù„Ø¹Ø¨Ø© -->
            <div class="game-header">
                <div class="current-turn">
                    <span>Ø§Ù„Ø¯ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠ:</span>
                    <div class="turn-indicator" id="turnIndicator">X</div>
                    <span id="currentPlayer">Ø£Ù†Øª (X)</span>
                </div>
                <div class="game-stats">
                    <div id="gameStatus">Ø§Ù†ØªØ¸Ø§Ø± Ø®ØµÙ…...</div>
                    <div class="game-timer" id="gameTimer">Ø§Ù„ÙˆÙ‚Øª: 00:00</div>
                </div>
            </div>

            <!-- Ù„ÙˆØ­Ø© XO -->
            <div class="xo-board" id="xoBoard">
                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¡ Ø§Ù„Ø®Ù„Ø§ÙŠØ§ Ø¨Ø§Ù„Ø¬Ø§ÙØ§ Ø³ÙƒØ±ÙŠØ¨Øª -->
            </div>

            <!-- Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø© -->
            <div class="game-actions">
                <button class="btn btn-success" id="startGame" disabled>
                    <i class="fas fa-play"></i> Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø©
                </button>
                <button class="btn btn-accent" id="resetGame" disabled>
                    <i class="fas fa-redo"></i> Ø¥Ø¹Ø§Ø¯Ø©
                </button>
                <button class="btn btn-light" id="leaveGame" disabled>
                    <i class="fas fa-sign-out-alt"></i> Ù…ØºØ§Ø¯Ø±Ø©
                </button>
            </div>

            <!-- Ù„ÙˆØ­Ø© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© -->
            <div class="chat-panel">
                <div class="chat-header">
                    <div class="chat-title">
                        <i class="fas fa-comments"></i> Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©
                        <div class="online-count" id="onlineCount">1 Ù…ØªØµÙ„</div>
                    </div>
                    <button class="btn btn-light" id="clearChat" style="padding: 5px 10px; font-size: 0.8rem;">
                        <i class="fas fa-trash-alt"></i> Ù…Ø³Ø­
                    </button>
                </div>
                <div class="chat-messages" id="chatMessages">
                    <div class="message system">
                        <div class="message-content">Ù…Ø±Ø­Ø¨Ù‹Ø§! ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù„Ø¹Ø¨Ø©.</div>
                    </div>
                </div>
                <div class="chat-input">
                    <input type="text" id="chatInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§...">
                    <button class="btn btn-primary" id="sendMessage">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
    <div class="modal-overlay" id="settingsModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-cog"></i> Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h3>
                <button class="close-modal" id="closeSettings">&times;</button>
            </div>
            <form id="settingsForm">
                <div class="form-group">
                    <label for="playerName">Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨:</label>
                    <input type="text" id="playerName" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ" required>
                </div>

                <div class="form-group">
                    <label>Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ù…ÙØ¶Ù„:</label>
                    <div class="language-switch">
                        <button type="button" class="lang-btn active" id="colorLangAr">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</button>
                        <button type="button" class="lang-btn" id="colorLangEn">English</button>
                    </div>
                    
                    <div id="colorOptionsAr">
                        <select id="colorSelectAr" class="form-control">
                            <option value="#3b5cff">Ø£Ø²Ø±Ù‚</option>
                            <option value="#ff4444">Ø£Ø­Ù…Ø±</option>
                            <option value="#4CAF50">Ø£Ø®Ø¶Ø±</option>
                            <option value="#FF9800">Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ</option>
                            <option value="#9C27B0">Ø¨Ù†ÙØ³Ø¬ÙŠ</option>
                            <option value="#FF4081">ÙˆØ±Ø¯ÙŠ</option>
                            <option value="#00BCD4">ØªØ±ÙƒÙˆØ§Ø²</option>
                            <option value="#FFC107">Ø°Ù‡Ø¨ÙŠ</option>
                        </select>
                    </div>
                    
                    <div id="colorOptionsEn" style="display: none;">
                        <select id="colorSelectEn" class="form-control">
                            <option value="#3b5cff">Blue</option>
                            <option value="#ff4444">Red</option>
                            <option value="#4CAF50">Green</option>
                            <option value="#FF9800">Orange</option>
                            <option value="#9C27B0">Purple</option>
                            <option value="#FF4081">Pink</option>
                            <option value="#00BCD4">Turquoise</option>
                            <option value="#FFC107">Gold</option>
                        </select>
                    </div>
                    
                    <div class="color-preview" id="colorPreview"></div>
                </div>

                <div class="form-group">
                    <label>Ø±Ù…Ø² Ø§Ù„Ù„Ø§Ø¹Ø¨:</label>
                    <div class="symbol-options">
                        <div class="symbol-option active symbol-x" data-symbol="X">X</div>
                        <div class="symbol-option symbol-o" data-symbol="O">O</div>
                        <div class="symbol-option symbol-heart" data-symbol="â™¥">â™¥</div>
                        <div class="symbol-option symbol-star" data-symbol="â˜…">â˜…</div>
                    </div>
                    <input type="hidden" id="playerSymbol" value="X">
                </div>

                <div class="bg-options">
                    <label>Ø®Ù„ÙÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø©:</label>
                    <div class="bg-preview" id="bgPreview"></div>
                    <div class="bg-actions">
                        <button type="button" class="btn btn-light" id="uploadBg">
                            <i class="fas fa-upload"></i> Ø±ÙØ¹ ØµÙˆØ±Ø©
                        </button>
                        <button type="button" class="btn btn-light" id="resetBg">
                            <i class="fas fa-times"></i> Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¶Ø¨Ø·
                        </button>
                    </div>
                    <input type="file" id="bgUpload" accept="image/*" style="display: none;">
                </div>

                <div class="form-group">
                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        <i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø®ØµÙ… -->
    <div class="modal-overlay" id="opponentModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-search"></i> Ø§Ø¨Ø­Ø« Ø¹Ù† Ø®ØµÙ…</h3>
                <button class="close-modal" id="closeOpponent">&times;</button>
            </div>
            <div id="availableOpponents">
                <div style="text-align: center; padding: 20px;">
                    <i class="fas fa-spinner fa-spin fa-2x" style="color: var(--primary); margin-bottom: 15px;"></i>
                    <p>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø®ØµÙ…...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„ÙØ§Ø¦Ø² -->
    <div class="modal-overlay" id="winnerModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="winnerTitle"><i class="fas fa-trophy"></i> Ø§Ù„Ù†ØªÙŠØ¬Ø©</h3>
                <button class="close-modal" id="closeWinner">&times;</button>
            </div>
            <div style="text-align: center; padding: 20px;">
                <div id="winnerIcon" style="font-size: 4rem; margin-bottom: 20px;">ğŸ†</div>
                <h2 id="winnerText" style="color: var(--primary); margin-bottom: 10px;">ÙØ§Ø² X!</h2>
                <p id="winnerMessage" style="color: var(--gray); margin-bottom: 20px;">ØªÙ‡Ø§Ù†ÙŠÙ†Ø§ Ø¹Ù„Ù‰ Ø§Ù„ÙÙˆØ²!</p>
                <div class="game-actions" style="justify-content: center;">
                    <button class="btn btn-primary" id="playAgain">Ø§Ù„Ø¹Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</button>
                    <button class="btn btn-light" id="backToLobby">Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù„ÙˆØ¨ÙŠ</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Ø¥Ø´Ø¹Ø§Ø±Ø§Øª -->
    <div class="notification" id="notification">
        <div class="notification-icon">
            <i class="fas fa-info-circle"></i>
        </div>
        <div>
            <div id="notificationTitle">Ø¥Ø´Ø¹Ø§Ø±</div>
            <div id="notificationMessage">Ù‡Ø°Ù‡ Ø±Ø³Ø§Ù„Ø© Ø¥Ø´Ø¹Ø§Ø±</div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

    <script>
        // ===== ØªÙ‡ÙŠØ¦Ø© Firebase =====
        const firebaseConfig = {
            apiKey: "AIzaSyCRwY0eiSttQIVT7iBHgcHQQosSpEAA-LM",
            authDomain: "minichaat-net.firebaseapp.com",
            projectId: "minichaat-net",
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // ===== Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© =====
        let currentUser = null;
        let gameRoom = null;
        let opponent = null;
        let isMyTurn = false;
        let playerSymbol = "X";
        let playerColor = "#3b5cff";
        let gameTimer = null;
        let gameTime = 0;
        let language = "ar";
        let customBackground = null;

        // ===== ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø© =====
        document.addEventListener('DOMContentLoaded', function() {
            initGame();
            loadUserSettings();
            createGameBoard();
            initEventListeners();
        });

        // ===== ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© =====
        function initGame() {
            // Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ù…Ø¬Ù‡ÙˆÙ„ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
            auth.signInAnonymously()
                .then(() => {
                    currentUser = auth.currentUser;
                    setupUserListener();
                    setupGameListener();
                    updateOnlinePlayers();
                    updateLeaderboard();
                })
                .catch(error => {
                    console.error("Authentication error:", error);
                    showNotification("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©", "ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…", "error");
                });
        }

        // ===== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… =====
        function loadUserSettings() {
            const savedName = localStorage.getItem('xo-player-name');
            const savedColor = localStorage.getItem('xo-player-color');
            const savedSymbol = localStorage.getItem('xo-player-symbol');
            const savedLanguage = localStorage.getItem('xo-language');
            const savedBg = localStorage.getItem('xo-background');

            if (savedName) document.getElementById('playerName').value = savedName;
            if (savedColor) {
                playerColor = savedColor;
                document.getElementById('colorPreview').style.backgroundColor = savedColor;
            }
            if (savedSymbol) {
                playerSymbol = savedSymbol;
                document.getElementById('playerSymbol').value = savedSymbol;
                updateSymbolSelection(savedSymbol);
            }
            if (savedLanguage) {
                language = savedLanguage;
                updateLanguageDisplay();
            }
            if (savedBg) {
                customBackground = savedBg;
                document.body.style.backgroundImage = `url(${savedBg})`;
                document.body.classList.add('custom-bg');
                document.getElementById('bgPreview').style.backgroundImage = `url(${savedBg})`;
            }

            updateUserDisplay();
        }

        function saveUserSettings(name, color, symbol, lang) {
            localStorage.setItem('xo-player-name', name);
            localStorage.setItem('xo-player-color', color);
            localStorage.setItem('xo-player-symbol', symbol);
            localStorage.setItem('xo-language', lang);
            
            playerColor = color;
            playerSymbol = symbol;
            language = lang;
            
            updateUserDisplay();
            showNotification("ØªÙ… Ø§Ù„Ø­ÙØ¸", "ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­", "success");
        }

        function updateUserDisplay() {
            const name = document.getElementById('playerName').value || "Ù„Ø§Ø¹Ø¨";
            const firstLetter = name.charAt(0).toUpperCase();
            
            document.getElementById('userName').textContent = name;
            document.getElementById('userAvatar').textContent = firstLetter;
            document.getElementById('userAvatar').style.background = playerColor;
            document.getElementById('colorPreview').style.backgroundColor = playerColor;
            
            // ØªØ­Ø¯ÙŠØ« Ø±Ù…Ø² Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©
            updateUserInFirestore();
        }

        function updateUserInFirestore() {
            if (!currentUser) return;
            
            const userRef = db.collection('users').doc(currentUser.uid);
            userRef.set({
                name: document.getElementById('playerName').value || "Ù„Ø§Ø¹Ø¨",
                color: playerColor,
                symbol: playerSymbol,
                status: 'online',
                lastSeen: firebase.firestore.FieldValue.serverTimestamp(),
                score: parseInt(localStorage.getItem('xo-player-score')) || 0,
                wins: parseInt(localStorage.getItem('xo-player-wins')) || 0
            }, { merge: true });
        }

        // ===== Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„Ø£Ø­Ø¯Ø§Ø« =====
        function initEventListeners() {
            // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©
            document.getElementById('changeSettings').addEventListener('click', () => {
                document.getElementById('settingsModal').classList.add('active');
            });
            
            document.getElementById('closeSettings').addEventListener('click', () => {
                document.getElementById('settingsModal').classList.remove('active');
            });
            
            document.getElementById('settingsForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const name = document.getElementById('playerName').value;
                const color = language === 'ar' ? 
                    document.getElementById('colorSelectAr').value : 
                    document.getElementById('colorSelectEn').value;
                const symbol = document.getElementById('playerSymbol').value;
                
                saveUserSettings(name, color, symbol, language);
                document.getElementById('settingsModal').classList.remove('active');
            });
            
            // ØªØºÙŠÙŠØ± Ø§Ù„Ù„ØºØ© Ù„Ù„Ø£Ù„ÙˆØ§Ù†
            document.getElementById('colorLangAr').addEventListener('click', function() {
                language = 'ar';
                document.getElementById('colorLangAr').classList.add('active');
                document.getElementById('colorLangEn').classList.remove('active');
                document.getElementById('colorOptionsAr').style.display = 'block';
                document.getElementById('colorOptionsEn').style.display = 'none';
                localStorage.setItem('xo-language', 'ar');
            });
            
            document.getElementById('colorLangEn').addEventListener('click', function() {
                language = 'en';
                document.getElementById('colorLangEn').classList.add('active');
                document.getElementById('colorLangAr').classList.remove('active');
                document.getElementById('colorOptionsAr').style.display = 'none';
                document.getElementById('colorOptionsEn').style.display = 'block';
                localStorage.setItem('xo-language', 'en');
            });
            
            // Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø±Ù…ÙˆØ²
            document.querySelectorAll('.symbol-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.symbol-option').forEach(opt => {
                        opt.classList.remove('active');
                    });
                    this.classList.add('active');
                    const symbol = this.getAttribute('data-symbol');
                    document.getElementById('playerSymbol').value = symbol;
                });
            });
            
            // Ø®Ù„ÙÙŠØ© Ø§Ù„ØµÙØ­Ø©
            document.getElementById('uploadBg').addEventListener('click', () => {
                document.getElementById('bgUpload').click();
            });
            
            document.getElementById('bgUpload').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        customBackground = event.target.result;
                        document.body.style.backgroundImage = `url(${customBackground})`;
                        document.body.classList.add('custom-bg');
                        document.getElementById('bgPreview').style.backgroundImage = `url(${customBackground})`;
                        localStorage.setItem('xo-background', customBackground);
                        showNotification("ØªÙ… Ø§Ù„ØªØ­Ù…ÙŠÙ„", "ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ø®Ù„ÙÙŠØ© Ø¨Ù†Ø¬Ø§Ø­", "success");
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            document.getElementById('resetBg').addEventListener('click', function() {
                customBackground = null;
                document.body.style.backgroundImage = '';
                document.body.classList.remove('custom-bg');
                document.getElementById('bgPreview').style.backgroundImage = '';
                localStorage.removeItem('xo-background');
                showNotification("ØªÙ… Ø§Ù„Ø¥Ø¹Ø§Ø¯Ø©", "ØªÙ…Øª Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©", "info");
            });
            
            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø®ØµÙ…
            document.getElementById('findOpponent').addEventListener('click', () => {
                document.getElementById('opponentModal').classList.add('active');
                findOpponent();
            });
            
            document.getElementById('closeOpponent').addEventListener('click', () => {
                document.getElementById('opponentModal').classList.remove('active');
            });
            
            // Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©
            document.getElementById('startGame').addEventListener('click', startGame);
            document.getElementById('resetGame').addEventListener('click', resetGame);
            document.getElementById('leaveGame').addEventListener('click', leaveGame);
            
            // Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©
            document.getElementById('sendMessage').addEventListener('click', sendChatMessage);
            document.getElementById('chatInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') sendChatMessage();
            });
            document.getElementById('clearChat').addEventListener('click', clearChat);
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ†
            document.getElementById('refreshLeaderboard').addEventListener('click', updateLeaderboard);
            
            // Ù†Ø§ÙØ°Ø© Ø§Ù„ÙØ§Ø¦Ø²
            document.getElementById('closeWinner').addEventListener('click', () => {
                document.getElementById('winnerModal').classList.remove('active');
            });
            document.getElementById('playAgain').addEventListener('click', playAgain);
            document.getElementById('backToLobby').addEventListener('click', backToLobby);
            
            // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù„ÙˆÙ†
            document.getElementById('colorSelectAr').addEventListener('change', function() {
                document.getElementById('colorPreview').style.backgroundColor = this.value;
            });
            document.getElementById('colorSelectEn').addEventListener('change', function() {
                document.getElementById('colorPreview').style.backgroundColor = this.value;
            });
        }

        // ===== Ù„ÙˆØ­Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© =====
        function createGameBoard() {
            const board = document.getElementById('xoBoard');
            board.innerHTML = '';
            
            for (let i = 0; i < 9; i++) {
                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.dataset.index = i;
                cell.addEventListener('click', () => makeMove(i));
                board.appendChild(cell);
            }
        }

        function makeMove(index) {
            if (!isMyTurn || !gameRoom) return;
            
            const cell = document.querySelector(`.cell[data-index="${index}"]`);
            if (cell.textContent !== '') return;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø®Ù„ÙŠØ© Ù…Ø­Ù„ÙŠØ§Ù‹
            cell.textContent = playerSymbol;
            cell.classList.add(playerSymbol.toLowerCase());
            
            // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø­Ø±ÙƒØ© Ø¥Ù„Ù‰ Firebase
            const gameRef = db.collection('games').doc(gameRoom);
            gameRef.update({
                [`board.${index}`]: playerSymbol,
                turn: opponent.id,
                lastMove: firebase.firestore.FieldValue.serverTimestamp()
            });
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙØ§Ø¦Ø²
            checkWinner();
        }

        // ===== Ù†Ø¸Ø§Ù… Ø§Ù„Ù„Ø¹Ø¨ Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† =====
        function findOpponent() {
            const opponentsList = document.getElementById('availableOpponents');
            opponentsList.innerHTML = `
                <div style="text-align: center; padding: 20px;">
                    <i class="fas fa-spinner fa-spin fa-2x" style="color: var(--primary); margin-bottom: 15px;"></i>
                    <p>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø®ØµÙ…...</p>
                </div>
            `;
            
            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù…ØªØ§Ø­ÙŠÙ†
            db.collection('users')
                .where('status', '==', 'waiting')
                .where('uid', '!=', currentUser.uid)
                .limit(5)
                .get()
                .then(snapshot => {
                    if (snapshot.empty) {
                        // Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø®ØµÙˆÙ…ØŒ Ø§Ù†ØªØ¸Ø§Ø± Ø®ØµÙ…
                        waitForOpponent();
                        opponentsList.innerHTML = `
                            <div style="text-align: center; padding: 20px;">
                                <i class="fas fa-user-clock fa-2x" style="color: var(--warning); margin-bottom: 15px;"></i>
                                <p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø®ØµÙˆÙ… Ù…ØªØ§Ø­ÙŠÙ† Ø­Ø§Ù„ÙŠØ§Ù‹</p>
                                <p>Ø¬Ø§Ø±Ù Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ù„Ø®ØµÙ…...</p>
                            </div>
                        `;
                    } else {
                        // Ø¹Ø±Ø¶ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„Ù…ØªØ§Ø­ÙŠÙ†
                        opponentsList.innerHTML = '<h4>Ø§Ù„Ù„Ø§Ø¹Ø¨ÙˆÙ† Ø§Ù„Ù…ØªØ§Ø­ÙˆÙ†:</h4>';
                        snapshot.forEach(doc => {
                            const player = doc.data();
                            const opponentDiv = document.createElement('div');
                            opponentDiv.className = 'leaderboard-item';
                            opponentDiv.style.cursor = 'pointer';
                            opponentDiv.innerHTML = `
                                <div class="leaderboard-rank rank-other">
                                    <i class="fas fa-gamepad"></i>
                                </div>
                                <div class="leaderboard-name">${player.name}</div>
                                <button class="btn btn-primary btn-sm" data-id="${doc.id}">
                                    ØªØ­Ø¯ÙŠ
                                </button>
                            `;
                            opponentDiv.querySelector('button').addEventListener('click', () => {
                                challengePlayer(doc.id);
                            });
                            opponentsList.appendChild(opponentDiv);
                        });
                        
                        // Ø®ÙŠØ§Ø± Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±
                        const waitDiv = document.createElement('div');
                        waitDiv.className = 'leaderboard-item';
                        waitDiv.style.cursor = 'pointer';
                        waitDiv.style.marginTop = '10px';
                        waitDiv.innerHTML = `
                            <div class="leaderboard-rank rank-other">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="leaderboard-name">Ø§Ù†ØªØ¸Ø§Ø± Ø£ÙŠ Ø®ØµÙ…</div>
                            <button class="btn btn-secondary btn-sm" id="waitAny">
                                Ø§Ù†ØªØ¸Ø§Ø±
                            </button>
                        `;
                        opponentsList.appendChild(waitDiv);
                        
                        document.getElementById('waitAny').addEventListener('click', waitForOpponent);
                    }
                });
        }

        function waitForOpponent() {
            // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¥Ù„Ù‰ "Ø¨Ø§Ù†ØªØ¸Ø§Ø±"
            updateUserStatus('waiting');
            
            // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„ØªØ­Ø¯ÙŠ Ù…Ù† Ù„Ø§Ø¹Ø¨ Ø¢Ø®Ø±
            db.collection('gameRequests')
                .where('to', '==', currentUser.uid)
                .where('status', '==', 'pending')
                .onSnapshot(snapshot => {
                    snapshot.forEach(doc => {
                        const request = doc.data();
                        if (request.status === 'pending') {
                            // Ù‚Ø¨ÙˆÙ„ Ø§Ù„ØªØ­Ø¯ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø£Ùˆ Ø¹Ø±Ø¶ Ø·Ù„Ø¨ Ø§Ù„ØªØ­Ø¯ÙŠ
                            acceptChallenge(doc.id, request.from);
                        }
                    });
                });
            
            showNotification("Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø®ØµÙ…", "Ø¬Ø§Ø±Ù Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø®ØµÙ… Ù„Ùƒ", "info");
        }

        function challengePlayer(opponentId) {
            // Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ ØªØ­Ø¯ÙŠ
            const requestId = `${currentUser.uid}_${opponentId}_${Date.now()}`;
            db.collection('gameRequests').doc(requestId).set({
                from: currentUser.uid,
                to: opponentId,
                status: 'pending',
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            });
            
            showNotification("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ­Ø¯ÙŠ", "Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø®ØµÙ…", "info");
        }

        function acceptChallenge(requestId, opponentId) {
            // Ù‚Ø¨ÙˆÙ„ Ø§Ù„ØªØ­Ø¯ÙŠ ÙˆØ¥Ù†Ø´Ø§Ø¡ ØºØ±ÙØ© Ù„Ø¹Ø¨Ø©
            db.collection('gameRequests').doc(requestId).update({
                status: 'accepted'
            });
            
            createGameRoom(opponentId);
        }

        function createGameRoom(opponentId) {
            // Ø¥Ù†Ø´Ø§Ø¡ ØºØ±ÙØ© Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©
            const roomId = `game_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
            
            db.collection('games').doc(roomId).set({
                player1: currentUser.uid,
                player2: opponentId,
                board: ['', '', '', '', '', '', '', '', ''],
                turn: currentUser.uid, // Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø°ÙŠ Ø£Ù†Ø´Ø£ Ø§Ù„ØºØ±ÙØ© ÙŠØ¨Ø¯Ø£
                status: 'active',
                winner: null,
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                lastMove: firebase.firestore.FieldValue.serverTimestamp()
            });
            
            gameRoom = roomId;
            joinGameRoom(roomId);
        }

        function joinGameRoom(roomId) {
            gameRoom = roomId;
            
            // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            updateUserStatus('playing');
            
            // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„ØºØ±ÙØ©
            db.collection('games').doc(roomId).onSnapshot(doc => {
                if (!doc.exists) return;
                
                const game = doc.data();
                
                // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø®ØµÙ…
                const opponentId = game.player1 === currentUser.uid ? game.player2 : game.player1;
                getOpponentInfo(opponentId);
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù„ÙˆØ­Ø©
                updateBoard(game.board);
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¯ÙˆØ±
                isMyTurn = game.turn === currentUser.uid;
                updateTurnDisplay(isMyTurn, game.turn === currentUser.uid ? playerSymbol : (playerSymbol === 'X' ? 'O' : 'X'));
                
                // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
                if (game.winner) {
                    endGame(game.winner);
                }
                
                // Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø¤Ù‚Øª
                if (!gameTimer) {
                    startGameTimer();
                }
            });
            
            // ØªÙ…ÙƒÙŠÙ† Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ­ÙƒÙ…
            document.getElementById('startGame').disabled = true;
            document.getElementById('resetGame').disabled = false;
            document.getElementById('leaveGame').disabled = false;
            
            // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø®ØµÙ…
            document.getElementById('opponentModal').classList.remove('active');
            
            showNotification("ØªÙ… Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©", "ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ù…Ø¹ Ø§Ù„Ø®ØµÙ…", "success");
            addSystemMessage("Ø¨Ø¯Ø£Øª Ø§Ù„Ù„Ø¹Ø¨Ø©! Ø­Ø¸Ø§Ù‹ Ø·ÙŠØ¨Ø§Ù‹.");
        }

        // ===== ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø© =====
        function updateBoard(board) {
            const cells = document.querySelectorAll('.cell');
            cells.forEach((cell, index) => {
                cell.textContent = board[index] || '';
                cell.classList.remove('x', 'o', 'â™¥', 'â˜…');
                if (board[index]) {
                    cell.classList.add(board[index].toLowerCase());
                }
            });
        }

        function updateTurnDisplay(myTurn, currentSymbol) {
            const indicator = document.getElementById('turnIndicator');
            indicator.textContent = currentSymbol;
            indicator.className = `turn-indicator ${currentSymbol === 'X' ? 'turn-x' : 'turn-o'}`;
            
            document.getElementById('currentPlayer').textContent = 
                myTurn ? `Ø¯ÙˆØ±Ùƒ (${currentSymbol})` : `Ø¯ÙˆØ± Ø§Ù„Ø®ØµÙ… (${currentSymbol})`;
            
            // ØªÙ…ÙƒÙŠÙ†/ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø®Ù„Ø§ÙŠØ§
            const cells = document.querySelectorAll('.cell');
            cells.forEach(cell => {
                cell.classList.toggle('disabled', !myTurn);
            });
        }

        function checkWinner() {
            // Ø³ÙŠØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙØ§Ø¦Ø² ÙÙŠ Firebase
        }

        function endGame(winner) {
            clearInterval(gameTimer);
            gameTimer = null;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ù‚Ø§Ø· Ø¥Ø°Ø§ ÙØ§Ø² Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            if (winner === currentUser.uid) {
                const currentScore = parseInt(localStorage.getItem('xo-player-score')) || 0;
                const currentWins = parseInt(localStorage.getItem('xo-player-wins')) || 0;
                localStorage.setItem('xo-player-score', currentScore + 10);
                localStorage.setItem('xo-player-wins', currentWins + 1);
                updateUserStats();
                
                // Ø¹Ø±Ø¶ Ù†Ø§ÙØ°Ø© Ø§Ù„ÙØ§Ø¦Ø²
                document.getElementById('winnerTitle').innerHTML = '<i class="fas fa-trophy"></i> ÙØ²Øª!';
                document.getElementById('winnerIcon').textContent = 'ğŸ†';
                document.getElementById('winnerText').textContent = 'ØªÙ‡Ø§Ù†ÙŠÙ†Ø§! ÙØ²Øª Ø¨Ø§Ù„Ù„Ø¹Ø¨Ø©';
                document.getElementById('winnerMessage').textContent = 'Ù„Ù‚Ø¯ Ø£Ø¸Ù‡Ø±Øª Ù…Ù‡Ø§Ø±Ø© Ø±Ø§Ø¦Ø¹Ø©!';
                document.getElementById('winnerModal').classList.add('active');
                
                addSystemMessage("ğŸ‰ ÙØ²Øª Ø¨Ø§Ù„Ù„Ø¹Ø¨Ø©! ğŸ‰");
            } else if (winner === 'draw') {
                document.getElementById('winnerTitle').innerHTML = '<i class="fas fa-handshake"></i> ØªØ¹Ø§Ø¯Ù„';
                document.getElementById('winnerIcon').textContent = 'ğŸ¤';
                document.getElementById('winnerText').textContent = 'ØªØ¹Ø§Ø¯Ù„!';
                document.getElementById('winnerMessage').textContent = 'Ù„Ø§ ÙØ§Ø¦Ø² ÙˆÙ„Ø§ Ù…Ù‡Ø²ÙˆÙ… Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø±Ø©';
                document.getElementById('winnerModal').classList.add('active');
                
                addSystemMessage("âš¡ Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¨Ø§Ù„ØªØ¹Ø§Ø¯Ù„!");
            } else {
                addSystemMessage("ğŸ’” Ø®Ø³Ø±Øª Ù‡Ø°Ù‡ Ø§Ù„Ø¬ÙˆÙ„Ø©. Ø­Ø¸Ø§Ù‹ Ø£ÙˆÙØ± ÙÙŠ Ø§Ù„Ù…Ø±Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©!");
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ†
            updateLeaderboard();
        }

        // ===== Ø§Ù„Ù…Ø¤Ù‚Øª =====
        function startGameTimer() {
            gameTime = 0;
            gameTimer = setInterval(() => {
                gameTime++;
                const minutes = Math.floor(gameTime / 60);
                const seconds = gameTime % 60;
                document.getElementById('gameTimer').textContent = 
                    `Ø§Ù„ÙˆÙ‚Øª: ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
        }

        // ===== Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø© =====
        function startGame() {
            // ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§ Ù„Ù„Ø¹Ø¨Ø© Ø¶Ø¯ Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±
        }

        function resetGame() {
            if (!gameRoom) return;
            
            const gameRef = db.collection('games').doc(gameRoom);
            gameRef.update({
                board: ['', '', '', '', '', '', '', '', ''],
                turn: currentUser.uid,
                winner: null
            });
            
            clearInterval(gameTimer);
            gameTimer = null;
            gameTime = 0;
            document.getElementById('gameTimer').textContent = 'Ø§Ù„ÙˆÙ‚Øª: 00:00';
            
            addSystemMessage("ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ù„Ø¹Ø¨Ø©");
        }

        function leaveGame() {
            if (gameRoom) {
                db.collection('games').doc(gameRoom).delete();
                gameRoom = null;
            }
            
            clearInterval(gameTimer);
            gameTimer = null;
            
            updateUserStatus('online');
            
            document.getElementById('startGame').disabled = false;
            document.getElementById('resetGame').disabled = true;
            document.getElementById('leaveGame').disabled = true;
            
            addSystemMessage("ØºØ§Ø¯Ø±Øª Ø§Ù„Ù„Ø¹Ø¨Ø©");
            showNotification("ØºØ§Ø¯Ø±Øª Ø§Ù„Ù„Ø¹Ø¨Ø©", "ØªÙ… Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù„ÙˆØ¨ÙŠ", "info");
        }

        function playAgain() {
            document.getElementById('winnerModal').classList.remove('active');
            resetGame();
        }

        function backToLobby() {
            document.getElementById('winnerModal').classList.remove('active');
            leaveGame();
        }

        // ===== Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© =====
        function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message || !gameRoom) return;
            
            // Ø­ÙØ¸ Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙÙŠ Firebase
            db.collection('chats').add({
                roomId: gameRoom,
                senderId: currentUser.uid,
                senderName: document.getElementById('playerName').value || "Ù„Ø§Ø¹Ø¨",
                message: message,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            });
            
            input.value = '';
        }

        function clearChat() {
            const messagesContainer = document.getElementById('chatMessages');
            messagesContainer.innerHTML = '';
            addSystemMessage("ØªÙ… Ù…Ø³Ø­ Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„ØºØ±ÙØ©");
        }

        function addSystemMessage(text) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message system';
            messageDiv.innerHTML = `
                <div class="message-content">${text}</div>
            `;
            messagesContainer.insertBefore(messageDiv, messagesContainer.firstChild);
            
            // Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø¹Ø¯Ø¯ Ù…Ø¹Ù‚ÙˆÙ„ Ù…Ù† Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
            const messages = messagesContainer.querySelectorAll('.message');
            if (messages.length > 100) {
                messagesContainer.removeChild(messages[messages.length - 1]);
            }
        }

        // ===== Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ† =====
        function updateLeaderboard() {
            db.collection('users')
                .orderBy('score', 'desc')
                .limit(10)
                .get()
                .then(snapshot => {
                    const leaderboardList = document.getElementById('leaderboardList');
                    leaderboardList.innerHTML = '';
                    
                    let rank = 1;
                    snapshot.forEach(doc => {
                        const player = doc.data();
                        const isCurrentUser = doc.id === currentUser.uid;
                        
                        const item = document.createElement('div');
                        item.className = `leaderboard-item ${isCurrentUser ? 'current-user' : ''}`;
                        
                        let rankClass = 'rank-other';
                        if (rank === 1) rankClass = 'rank-1';
                        else if (rank === 2) rankClass = 'rank-2';
                        else if (rank === 3) rankClass = 'rank-3';
                        
                        item.innerHTML = `
                            <div class="leaderboard-rank ${rankClass}">${rank}</div>
                            <div class="leaderboard-name">
                                ${isCurrentUser ? '<i class="fas fa-user" style="margin-left: 5px;"></i>' : ''}
                                ${player.name}
                            </div>
                            <div class="leaderboard-score">${player.score || 0}</div>
                        `;
                        
                        leaderboardList.appendChild(item);
                        rank++;
                    });
                });
        }

        function updateUserStats() {
            const score = parseInt(localStorage.getItem('xo-player-score')) || 0;
            const wins = parseInt(localStorage.getItem('xo-player-wins')) || 0;
            
            document.getElementById('userScore').textContent = score;
            document.getElementById('userWins').textContent = wins;
            
            // ØªØ­Ø¯ÙŠØ« ÙÙŠ Firebase
            if (currentUser) {
                db.collection('users').doc(currentUser.uid).update({
                    score: score,
                    wins: wins
                });
            }
        }

        // ===== Ø§Ù„Ù„Ø§Ø¹Ø¨ÙˆÙ† Ø§Ù„Ù…ØªØµÙ„ÙˆÙ† =====
        function updateOnlinePlayers() {
            db.collection('users')
                .where('status', 'in', ['online', 'waiting', 'playing'])
                .limit(20)
                .onSnapshot(snapshot => {
                    const onlineCount = snapshot.size;
                    document.getElementById('onlineCount').textContent = `${onlineCount} Ù…ØªØµÙ„`;
                    
                    const playersContainer = document.getElementById('playersOnline');
                    playersContainer.innerHTML = '';
                    
                    snapshot.forEach(doc => {
                        const player = doc.data();
                        const isCurrentUser = doc.id === currentUser.uid;
                        if (isCurrentUser) return;
                        
                        const badge = document.createElement('div');
                        badge.className = 'player-badge';
                        
                        let indicatorClass = 'indicator-online';
                        if (player.status === 'playing') indicatorClass = 'indicator-playing';
                        else if (player.status === 'waiting') indicatorClass = 'indicator-waiting';
                        
                        badge.innerHTML = `
                            <div class="player-indicator ${indicatorClass}"></div>
                            <span>${player.name}</span>
                        `;
                        
                        playersContainer.appendChild(badge);
                    });
                });
        }

        // ===== Ø§Ø³ØªÙ…Ø¹Ø§Øª Firebase =====
        function setupUserListener() {
            // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§ØªØµØ§Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            updateUserStatus('online');
            
            // ØªØ­Ø¯ÙŠØ« Ø¢Ø®Ø± Ø¸Ù‡ÙˆØ± Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©
            setInterval(() => {
                if (currentUser) {
                    db.collection('users').doc(currentUser.uid).update({
                        lastSeen: firebase.firestore.FieldValue.serverTimestamp()
                    });
                }
            }, 30000);
            
            // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ù†Ø¯ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØµÙØ­Ø©
            window.addEventListener('beforeunload', () => {
                if (currentUser) {
                    db.collection('users').doc(currentUser.uid).update({
                        status: 'offline',
                        lastSeen: firebase.firestore.FieldValue.serverTimestamp()
                    });
                }
            });
        }

        function setupGameListener() {
            // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªØ­Ø¯ÙŠ
            db.collection('gameRequests')
                .where('to', '==', currentUser.uid)
                .where('status', '==', 'pending')
                .onSnapshot(snapshot => {
                    snapshot.forEach(doc => {
                        const request = doc.data();
                        if (confirm(`ØªØ­Ø¯ÙŠ Ù…Ù† Ù„Ø§Ø¹Ø¨! Ù‡Ù„ ØªÙ‚Ø¨Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØŸ`)) {
                            acceptChallenge(doc.id, request.from);
                        } else {
                            db.collection('gameRequests').doc(doc.id).update({
                                status: 'rejected'
                            });
                        }
                    });
                });
            
            // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„Ø¯Ø±Ø¯Ø´Ø©
            if (gameRoom) {
                db.collection('chats')
                    .where('roomId', '==', gameRoom)
                    .orderBy('timestamp', 'desc')
                    .limit(50)
                    .onSnapshot(snapshot => {
                        const messagesContainer = document.getElementById('chatMessages');
                        
                        snapshot.docChanges().forEach(change => {
                            if (change.type === 'added') {
                                const message = change.doc.data();
                                const isSent = message.senderId === currentUser.uid;
                                
                                const messageDiv = document.createElement('div');
                                messageDiv.className = `message ${isSent ? 'sent' : 'received'}`;
                                
                                const time = message.timestamp ? 
                                    new Date(message.timestamp.toDate()).toLocaleTimeString('ar-EG', {hour: '2-digit', minute:'2-digit'}) : 
                                    'Ø§Ù„Ø¢Ù†';
                                
                                messageDiv.innerHTML = `
                                    <div class="message-header">
                                        <span class="message-sender">${message.senderName}</span>
                                        <span class="message-time">${time}</span>
                                    </div>
                                    <div class="message-content">${message.message}</div>
                                `;
                                
                                if (isSent) {
                                    messageDiv.style.background = playerColor;
                                }
                                
                                messagesContainer.insertBefore(messageDiv, messagesContainer.firstChild);
                            }
                        });
                    });
            }
        }

        function updateUserStatus(status) {
            if (!currentUser) return;
            
            db.collection('users').doc(currentUser.uid).update({
                status: status,
                lastSeen: firebase.firestore.FieldValue.serverTimestamp()
            });
            
            document.getElementById('userStatus').textContent = 
                status === 'online' ? 'Ù…ØªØµÙ„' : 
                status === 'waiting' ? 'Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø®ØµÙ…' : 
                status === 'playing' ? 'ÙŠÙ„Ø¹Ø¨ Ø§Ù„Ø¢Ù†' : 'ØºÙŠØ± Ù…ØªØµÙ„';
            
            document.getElementById('userStatus').className = 
                `status-${status === 'online' ? 'online' : 
                status === 'waiting' ? 'waiting' : 
                status === 'playing' ? 'playing' : 'offline'}`;
        }

        // ===== ÙˆØ¸Ø§Ø¦Ù Ù…Ø³Ø§Ø¹Ø¯Ø© =====
        function getOpponentInfo(opponentId) {
            db.collection('users').doc(opponentId).get().then(doc => {
                if (doc.exists) {
                    opponent = { id: opponentId, ...doc.data() };
                    document.getElementById('gameStatus').textContent = `Ø§Ù„Ø®ØµÙ…: ${opponent.name}`;
                }
            });
        }

        function updateSymbolSelection(symbol) {
            document.querySelectorAll('.symbol-option').forEach(option => {
                option.classList.remove('active');
                if (option.getAttribute('data-symbol') === symbol) {
                    option.classList.add('active');
                }
            });
        }

        function updateLanguageDisplay() {
            if (language === 'ar') {
                document.getElementById('colorLangAr').click();
            } else {
                document.getElementById('colorLangEn').click();
            }
        }

        function showNotification(title, message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.className = `notification notification-${type}`;
            
            document.getElementById('notificationTitle').textContent = title;
            document.getElementById('notificationMessage').textContent = message;
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // ===== ØªÙ‡ÙŠØ¦Ø© Ø¥Ø¶Ø§ÙÙŠØ© =====
        updateUserStats();
    </script>
</body>
</html>
